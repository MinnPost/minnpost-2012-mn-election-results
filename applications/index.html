<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MinnPost</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
<script type='text/javascript' src='//s7.addthis.com/js/250/addthis_widget.js#async=1'></script>
<link rel="shortcut icon" href="http://www.minnpost.com//sites/default/themes/siteskin/favicon.ico" type="image/x-icon" />
<meta name="keywords" content="Mark Dayton,Minnesota DFL,Minnesota GOP,Minnesota Legislature,Vikings Stadium,Voter ID Amendment" />
<meta name="description" content="  " />
<meta property="og:title" content="The 2012 Legislative session: What did they pass?"/>
<meta property="og:site_name" content="MinnPost"/>
<meta property="og:description" content="Explore bills by category, investigate which bills Gov. Dayton vetoed, and search by your legislators.
"/>
<meta property="og:image" content="http://www.minnpost.com/sites/default/files/images/thumbnails/fullpagearticles/BillExplorerGraphic3.png"/>
<link rel="apple-touch-icon" href="http://www.minnpost.com//sites/default/themes/siteskin/inc/images/apple-touch-icon.png" />
<meta name="viewport" content="width=device-width, initial-scale=1"></meta>


  <link type="text/css" rel="stylesheet" media="all" href="http://www.minnpost.com/sites/default/files/css/css_75f46449977752fa2b72049f240adc81.css" />
<link type="text/css" rel="stylesheet" media="screen" href="http://www.minnpost.com/sites/default/files/css/css_6b2b28228f4e06a47e93d96b2abfeb4b.css" />
<link type="text/css" rel="stylesheet" media="print" href="http://www.minnpost.com/sites/default/files/css/css_93f63f4f94c282fd52e692fdfd1851a4.css" />
  <!--[if IE]>
      <link rel="stylesheet" href="http://www.minnpost.com/sites/default/themes/derma/inc/css/ie.css?8" type="text/css">
  <![endif]-->
    <script type="text/javascript" src="http://www.minnpost.com/sites/default/files/js/js_dc54b7005f8be1b8e26316c2b9d61bd4.js"></script>
<script type="text/javascript" src="http://www.minnpost.com/sites/all/libraries/tinymce/jscripts/tiny_mce/tiny_mce.js?8"></script>
    

</head>
<body class="not-front logged-in page-node node-type-article one-sidebar sidebar-right admin-nw admin-vertical admin-df  section-data section-data-id-2012 section-data-id-2012-id-05 section-data-id-2012-id-05-how-we-built-legislative-bill-explorer one-sidebar sidebar-right">
<div class="outside-embeddable-container">




  <!-- START: Embeddable -->
  <div class="node-body fieldlayout node-field-body">
    
    <style type="text/css">
      #minnpost-2012-mn-election-results {
        max-width: 960px;
        margin: 0 auto;
      }
      .clear {
        clear: both;
      }
      .js-dependent,
      .hidden {
        display: none;
      }
      
      .footnote {
        font-size: .75em;
        font-style: italic;
        color: #414141;
        margin-top: 1em;
      }
      
      #minnpost-2012-mn-election-results table {
        width: 100%;
      }
    </style>
    
    
    
    <!-- Initial HTML for application -->
    <div id="minnpost-2012-mn-election-results">
      <noscript>
        <p>This application requires Javascript which is used to make your web browser more interactive.  If this message does not go away, please consider enabling Javascript.  Here are <a href="http://www.enable-javascript.com/" target="_blank">instructions on how to enable JavaScript in your web browser</a>.</p>
      </noscript>
      
      <div id="application-container">
      </div>
      
      <p class="footnote">Election data provided by the <a href="http://www.sos.state.mn.us/" target="_blank">MN Secretary of State</a>.</p>
    </div>
    
    <!-- Templates to be used in client side processing. -->
    <script id="template-race-view" type="text/template">
      <% if (typeof race == 'undefined') { %>
        <p>No race or contest found.</p>
      <% } else { %>
        <h3><%= race %></h3>
        <p>
          Last updated: <%= updated_moment.format('MMM Do h:mm a') %><br />
          Precincts reporting: <%= precincts_reporting %> of <%= total_effected_precincts %> 
          (<%= precincts_percentage.toFixed(2) %>%)
        </p>
        <table>
          <thead>
            <tr><th>Candidate</th><th>Party</th><th>Votes</th><th>Percentage</th></tr>
          </thead>
          <tbody>
            <% candidates = _.sortBy(candidates, function(c) {  return c.percentage * -1; }); %>
            <% for (var c in candidates) { %>
              <% if (candidates[c].candidate !== 'WRITE-IN**' || candidates[c].percentage > 10) { %>
                <tr>
                  <th><%= candidates[c].candidate %></th>
                  <th><%= candidates[c].party_id %></th>
                  <th><%= candidates[c].votes_candidate %></th>
                  <th><%= candidates[c].percentage %></th>
                </tr>
              <% } %>
            <% } %>
          </tbody>
        </table>
      <% } %>
    </script>
  
  
  
    <!-- jQuery that is used on site -->
    <script type="text/javascript">
      window.jQuery || document.write('<script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-1.3.2/jquery-1.3.2.min.js"><\/script>')
    </script>
    <!-- Underscore, a custom jquery, and backbone for app logic -->
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/underscore-1.3.3/underscore-min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/jquery-custom-master-20120606/jquery-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/backbone-0.9.2/backbone-min.js"></script>
    <!-- Date handling -->
    <script type="text/javascript" src="https://s3.amazonaws.com/data.minnpost/js/moment.js-1.7.2/moment.min.js"></script>
    
    <script type="text/javascript">
      // Handle custom jQuery
      jQueryCustom = jQueryCustom.noConflict();
      Backbone.setDomLibrary(jQueryCustom);
        
      (function($, w, undefined) {
      
        // Model for a single race
        var Race = Backbone.Model.extend({
          apiURL: 'http://box.scraperwiki.com/zzolo/mn-2012-election-results/sqlite?q=',
    
          url: function() {
            return this.apiURL + encodeURI("SELECT * FROM results_general WHERE race_id = '" + 
              this.get('race_id') + "' LIMIT 100");
          },
          
          parse: function(response) {
            var parsed = {};
            
            parsed.candidates = response;
            if (!_.isUndefined(response[0])) {
              parsed.race = response[0].office_name;
              parsed.updated = response[0].updated;
              parsed.updated_moment = moment.unix(response[0].updated);
              // parsed.updated_moment.utc(); // This should be UTC but no
              parsed.precincts_reporting = response[0].precincts_reporting;
              parsed.total_effected_precincts = response[0].total_effected_precincts;
              parsed.precincts_percentage = parsed.precincts_reporting / parsed.total_effected_precincts;
            }
            
            return parsed;
          }
        });
        
        // Collection for races
        var Races = Backbone.Collection.extend({
          url: function() {
            return 'http://box.scraperwiki.com/zzolo/mn-2012-election-results/';
          },
          
          parse: function(response) {
            return response;
          }
          
        });
        
        // View for a single race
        var RaceView = Backbone.View.extend({
          initialize: function() {
            this.template = $('#template-race-view').html();
          }, 
          
          render: function() {
            $(this.el).html(_.template(this.template, this.model.toJSON()));
            return this;
          }
          
        });
        
        // Main router and workspace for actions
        var Workspace = Backbone.Router.extend({
          routes: {
            'dashboard': 'dashboard',
            'search/:term': 'search',
            'race/:race': 'showRace',
            'races/:races': 'showRaceGroup',
            '*default': 'defaultRoute'
          },
        
          initialize: function() {
          },
        
          defaultRoute: function() {
            this.navigate('/dashboard', { trigger: true, replace: true });
          },
          
          showRace: function(raceID) {
            var testingRace = new Race({ 'race_id': raceID });
            var testingView = new RaceView({
              model: testingRace,
              el: '#application-container'
            });
            
            testingRace.on('change', function() {
              testingView.render();
            });
            
            testingRace.fetch();
          }
        
        });
          
        // When ready, make the magic happen
        $(document).ready(function() {
          // Start application
          var workspace = new Workspace();
          Backbone.history.start();
        });
      })(jQueryCustom, window);
    </script>
  </div>
  <!-- END: Embeddable -->




</div>
</body>
</html>